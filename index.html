<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake Game with Monster</title>
  <style>
    body {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:#fff;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #game {
      background:#1a1a2e;
      border-radius:12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    .ui {
      position:fixed;
      top:20px;
      left:20px;
      font-size:16px;
      background: rgba(255,255,255,0.1);
      padding: 14px;
      border-radius: 12px;
    }
    .diff-btn { margin:4px; padding:6px 12px; cursor:pointer; }
    .diff-btn.active { background:#4ecdc4; color:#000; }
    button { margin-top:8px; padding:8px; width:100%; }

    .touch-controls-wrapper {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
    }
    @media (min-width: 700px) {
      .touch-controls-wrapper { display:none; }
    }
    .touch-controls { display:flex; flex-direction:column; gap:8px; }
    .touch-controls-row { display:flex; gap:8px; }
    .touch-btn { width:70px; height:70px; font-size:30px; }
  </style>
</head>
<body>

<div class="ui">
  Score: <span id="score">0</span><br>
  High Score: <span id="highScore">0</span><br>

  <b>Difficulty:</b><br>
  <button class="diff-btn active" data-level="easy">Easy</button>
  <button class="diff-btn" data-level="normal">Normal</button>
  <button class="diff-btn" data-level="hard">Hard</button>

  <button id="restart">Restart</button>
</div>

<canvas id="game" width="400" height="400"></canvas>

<div class="touch-controls-wrapper">
  <div class="touch-controls">
    <button class="touch-btn" data-dir="up">▲</button>
    <div class="touch-controls-row">
      <button class="touch-btn" data-dir="left">◀</button>
      <button class="touch-btn" data-dir="down">▼</button>
      <button class="touch-btn" data-dir="right">▶</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const highScoreEl = document.getElementById("highScore");
const restartBtn = document.getElementById("restart");
const diffBtns = document.querySelectorAll(".diff-btn");
const touchBtns = document.querySelectorAll(".touch-btn");

const GRID = 20;
const COLS = 20;
const ROWS = 20;

let snake, dir, food, monster, score, running;
let monsterMoveCounter = 0;
let monstersFrozen = false;
let freezeDuration = 0;

let difficulty = "easy";
let highScore = 0;

const difficultySettings = {
  easy:   { speed:100, monsterInterval:5, monsterCount:1 },
  normal: { speed:80,  monsterInterval:4, monsterCount:1 },
  hard:   { speed:70,  monsterInterval:3, monsterCount:2 }
};

function resetGame(){
  snake = [{x:10,y:10}];
  dir = {x:1,y:0};
  food = randomPos();
  monster = [];
  score = 0;
  running = true;
  spawnMonsters();
  scoreEl.textContent = score;
}

function spawnMonsters(){
  const count = difficultySettings[difficulty].monsterCount;
  while(monster.length < count){
    monster.push(randomPos());
  }
}

function updateHardMonstersByScore(){
  if(difficulty !== "hard") return;

  let target = 2;
  if(score >= 800) target = 4;
  else if(score >= 400) target = 3;

  while(monster.length < target){
    monster.push(randomPos());
  }
}

function randomPos(){
  return {
    x: Math.floor(Math.random()*COLS),
    y: Math.floor(Math.random()*ROWS)
  };
}

function moveMonsters(){
  if(monstersFrozen) return;

  monster.forEach((m,i)=>{
    const head = snake[0];
    let dx = head.x - m.x;
    let dy = head.y - m.y;

    if(Math.abs(dx)>Math.abs(dy)) m.x += dx>0?1:-1;
    else m.y += dy>0?1:-1;

    m.x = (m.x+COLS)%COLS;
    m.y = (m.y+ROWS)%ROWS;
  });
}

function gameTick(){
  if(!running) return;

  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
  head.x = (head.x+COLS)%COLS;
  head.y = (head.y+ROWS)%ROWS;

  if(snake.some(s=>s.x===head.x && s.y===head.y)){
    return gameOver();
  }

  for(let m of monster){
    if(m.x===head.x && m.y===head.y)
      return gameOver();
  }

  snake.unshift(head);

  if(head.x===food.x && head.y===food.y){
    score+=10;
    scoreEl.textContent = score;
    food = randomPos();
    updateHardMonstersByScore();
  } else {
    snake.pop();
  }

  monsterMoveCounter++;
  if(monsterMoveCounter >= difficultySettings[difficulty].monsterInterval){
    moveMonsters();
    monsterMoveCounter = 0;
  }

  draw();
}

function gameOver(){
  running = false;
  if(score > highScore){
    highScore = score;
    highScoreEl.textContent = highScore;
  }
  alert("Game Over!");
}

function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,400,400);

  ctx.fillStyle="lime";
  snake.forEach(s=>{
    ctx.fillRect(s.x*GRID, s.y*GRID, GRID-2, GRID-2);
  });

  ctx.fillStyle="red";
  monster.forEach(m=>{
    ctx.beginPath();
    ctx.arc(m.x*GRID+10, m.y*GRID+10, 8, 0, Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle="yellow";
  ctx.fillRect(food.x*GRID, food.y*GRID, GRID-2, GRID-2);
}

function setDirection(d){
  if(d==="up" && dir.y!==1) dir={x:0,y:-1};
  if(d==="down" && dir.y!==-1) dir={x:0,y:1};
  if(d==="left" && dir.x!==1) dir={x:-1,y:0};
  if(d==="right" && dir.x!==-1) dir={x:1,y:0};
}

window.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp") setDirection("up");
  if(e.key==="ArrowDown") setDirection("down");
  if(e.key==="ArrowLeft") setDirection("left");
  if(e.key==="ArrowRight") setDirection("right");
});

touchBtns.forEach(btn=>{
  btn.addEventListener("click",()=>setDirection(btn.dataset.dir));
});

diffBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    diffBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    difficulty = btn.dataset.level;
    resetGame();
  });
});

restartBtn.onclick = resetGame;

resetGame();
setInterval(gameTick, 80);
</script>
</body>
</html>
